<head>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<form id="newExercise" action="/add">
    <!-- Form data to be sent where specified to in order to be added to 'workouts' table object -->

    <fieldset>

        <legend> Add Exercise: </legend>

        <label for="exercise">Exercise Name:</label>
        <input type="text" name="exercise" id="exercise"><br>

        <label for="reps"># of Reps:</label>
        <input type="number" name="reps" id="reps"><br>

        <label for="weight">Weight:</label>
        <input type="number" name="weight" id="weight"><br>

        <label for="date">Date:</label>
        <input type="date" name="date" id="date"><br>

        <label for="lbs">lbs</label> <!-- Radio button because selection for units is binary -->
        <input type="radio" name="lbs" value="1" id="lbs">

        <label for="kgs">kg</label>
        <input type="radio" name="lbs" value="0"><br>

        <input type="submit" id="submit" value="Submit">

    </fieldset>
</form>

<h2>Workout Info</h2>
<table id="workoutTable">
    <!-- Table object displayed to user, pulling from 'workouts' table object in MySQL database -->

    <tr>
        <th style="display:none"> ID
            <!-- Hidden ID column -->
        <th> Exercise Name</th>
        <th> # of Reps</th>
        <th> Weight</th>
        <th> Unit of Weight</th>
        <th> Date</th>
        <th> Edit</th>
        <th> Delete</th>
    </tr>

    {{#each workouts}}
    <!-- Use express-hanldebars built-in helper to address each parameter -->

    <tr>
        <td>{{this.name}} </td>
        <td>{{this.reps}} </td>
        <td>{{this.weight}} </td>
        <td>{{this.lbs}} </td>
        <td>{{this.date}} </td>

        <td> <a href="/updateExercise?id={{this.id}}"> <input type="button" value="Edit Exercise"> </a> </td>
        <!-- Button for Edit column, anchored to updateExercise command based on entry ID -->

        <!-- Deletion button calling on below script with inputs for the HTML table object, the current row via just 'this', and corresponding entry ID -->
        <td> <input type="button" value="Delete" onclick="deleteExercise('workoutTable',this,{{this.id}})"> </td>
    </tr>
    {{/each}}
</table>

<script>
    function deleteExercise(htmlTable, curRow, entryID) {

        var numRows = document.getElementById(htmlTable).rows.length // Get number of rows in table

        var req = new XMLHttpRequest()

        var queryStg = '/delete' // Prepare query string variable for AJAX 

        req.open("GET", queryStg + "?id=" + entryID, true) // GET delete request using entry-specific ID, async

        req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')

        req.addEventListener('load', function () {
            if (req.status >= 200 && req.status < 400) {
                console.log('DELETED') // Indicate success
            }

            else {
                console.log('ERROR')
            }
        })

        req.send(queryStg + "?id=" + entryID) // Complete AJAX interaction by having XMLHTTP request send '/delete?id' with unique ID entry

        for (var i = 0; i < numRows; i++) { // Update table that is being displayed  by looping through existing table based on number of rows
            var row = document.getElementById(htmlTable).rows[i]

            if (row == curRow.parentNode.parentNode) { // If 'row' data is equivalent to curRow i.e. 'this' for the row selected, then use DOM manipulation to delete it
                document.getElementById(htmlTable).deleteRow(i)
            }
        }
    }
</script>

<script src="app.js"> </script> <!-- Allow document to access app.js -->

<!-- 
    References
    Script vs Link
    https://stackoverflow.com/questions/12178429/whats-the-difference-between-using-link-and-script-tag-to-reference-javascript
    this 
    https://www.w3schools.com/js/js_this.asp
    parentNode
    https://developer.mozilla.org/en-US/docs/Web/API/Node/parentNode
-->